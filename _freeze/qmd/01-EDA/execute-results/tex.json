{
  "hash": "111c6178f0802cbaf2546c1214ad52c2",
  "result": {
    "engine": "knitr",
    "markdown": "---\nformat: html\nexecute:\n  fig-width: 7\n  fig-height: 4\nknitr:\n  opts_chunk:\n    out.width: \"100%\"\n---\n\n# Exploratory Data Analysis\n\n\n\n## Adjusted closing prices\nLet us plot the adjusted closing prices...\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfig_asml <- plot_ly(data = asml, x = ~Date, y = ~ASML.Adjusted, \n  type = 'scatter', mode = 'lines', name = 'ASML Adjusted',\n  line = list(color = 'darkblue', width = 1.5))\n\nfig_asml <- layout(\n  fig_asml,\n  title = \"ASML Stock Price Evolution\",\n  xaxis = list(\n    title = \"Date\",\n    rangeslider = list(visible = TRUE),\n    rangeselector = list(\n      buttons = list(\n        list(count=1, label=\"1m\", step=\"month\", stepmode=\"backward\"),\n        list(count=6, label=\"6m\", step=\"month\", stepmode=\"backward\"),\n        list(count=1, label=\"YTD\", step=\"year\", stepmode=\"todate\"),\n        list(count=1, label=\"1y\", step=\"year\", stepmode=\"backward\"),\n        list(step=\"all\")\n      )\n    )\n  )\n)\n\nfig_asml\n```\n\n::: {.cell-output-display}\n![ASML Daily Adjusted Closing Prices](01-EDA_files/figure-pdf/plot-prices-1.pdf){fig-pos='H' width=100%}\n:::\n:::\n\n\nThe graph clearly shows that the price series is **non-stationary**: the mean is not constant (it exhibits trends), and the variance appears to fluctuate depending on the price level. Consequently, standard statistical inference cannot be directly applied to prices.\n\n## Log returns\nTo obtain a stationary process, we transform prices into **log-returns**.\nLet $P_t$ be the price at time $t$. The simple net return is defined as:\n\n$$R_t = \\frac{P_t - P_{t-1}}{P_{t-1}}$$\n\nHowever, in financial econometrics, **log-returns** ($r_t$) are preferred due to their time-additivity property. The log-return is defined as the natural logarithm of the gross return:\n\n$$ r_t = \\ln\\left(\\frac{P_t}{P_{t-1}}\\right) = \\ln(P_t) - \\ln(P_{t-1}) $$\n\nWe compute the log-returns for ASML in R:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlog_ret_vec <- diff(log(asml$ASML.Adjusted))\nlog_ret_vec <- log_ret_vec[is.finite(log_ret_vec)]\n\nlog_returns <- data.frame(\n  Date = asml$Date[-1],\n  LogReturns = as.numeric(log_ret_vec)\n)\n```\n:::\n\n\nLet's visualize the log-returns of ASML:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfig_log <- plot_ly(data = log_returns, x = ~Date, y = ~LogReturns, type = 'scatter',\n  mode = 'lines', name = 'Log Returns', line = list(color = 'darkred', width = 1))\n\nfig_log <- layout(\n  fig_log,\n  title = \"ASML Log-Returns\",\n  xaxis = list(title = \"Date\"),\n  yaxis = list(title = \"Log Return\"),\n  shapes = list(\n    list(\n      type = \"line\",\n      x0 = min(log_returns$Date),\n      x1 = max(log_returns$Date),\n      y0 = 0, \n      y1 = 0,\n      line = list(color = \"black\", width = 1)\n    )\n  )\n)\n\nfig_log\n```\n\n::: {.cell-output-display}\n![ASML Daily Log-Returns](01-EDA_files/figure-pdf/plot-log-returns-1.pdf){fig-pos='H' width=100%}\n:::\n:::\n\n\nUnlike prices, the log-returns oscillate around a constant mean (close to zero). This behavior suggests that the return series is **stationary**, satisfying the conditions for further econometric analysis.\n\n## Distribution analysis\n\nWe analyze the distribution of log-returns to check for deviations from normality (e.g., fat tails or asymmetry).\n\n### Graphical representation\n\n#### Histogram\n\nThe graphical representation using a histogram of the frequency distribution of returns observed over a given sample period provides an initial indication of the characteristics of the probability distribution that generated them. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nmu_ret <- mean(log_returns$LogReturns)\nsd_ret <- sd(log_returns$LogReturns)\n\nt_fit_fGarch <- stdFit(log_returns$LogReturns * 100)\nt_params <- t_fit_fGarch$par\n\nfig_dist <- plot_ly(data = log_returns, x = ~LogReturns,\n  type = \"histogram\", name = \"Log Returns\", histnorm = \"probability density\",\n  marker = list(color = \"lightgray\", line = list(color = \"gray\", width = 1)),\n  opacity = 0.7)\n\nx_seq <- seq(min(log_returns$LogReturns), max(log_returns$LogReturns), length.out = 500)\n\ny_norm <- dnorm(x_seq, mean = mu_ret, sd = sd_ret)\ny_t <- dstd(\n  x_seq,\n  mean = t_params[\"mean\"]/100,\n  sd = t_params[\"sd\"]/100,\n  nu = t_params[\"nu\"]\n)\n\nfig_dist <- fig_dist %>%\n  add_lines(\n    x = x_seq,\n    y = y_norm,\n    name = \"Normal Distribution\",\n    line = list(color = \"#E74C3C\", width = 2, dash = \"dash\"),\n    inherit = FALSE\n  ) %>% \n  \n  add_lines(\n    x = x_seq,\n    y = y_t,\n    name = \"Student-t\",\n    line = list(color = \"#2E86C1\", width = 2),\n    inherit = FALSE\n  ) %>% \n  \n  layout(\n    title = \"Distribution of ASML Log-Returns\",\n    xaxis = list(title = \"Log Return\"),\n    yaxis = list(title = \"Density\"),\n    legend = list(x = 0.8, y = 0.9),\n    hovermode = \"x unified\"\n  )\n\nfig_dist\n```\n\n::: {.cell-output-display}\n![Histogram of ASML Log-Returns](01-EDA_files/figure-pdf/dist-plot-1.pdf){fig-pos='H' width=100%}\n:::\n:::\n\n\nThe histogram indicates that the distribution of log-returns is closer to a Student-t distribution than to a Normal distribution.\n\n#### Q-Q plot\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvec_ret <- log_returns$LogReturns\n\nqq_vals <- qqnorm(vec_ret, plot.it = FALSE)\nqq_data <- data.frame(\n  Theoretical = qq_vals$x,\n  Sample = qq_vals$y\n)\n\ny <- quantile(vec_ret, c(0.25, 0.75), names = FALSE)\nx <- qnorm(c(0.25, 0.75))\nslope <- diff(y)/diff(x)\nint <- y[1L] - slope * x[1L]\n\nfig_qq <- plot_ly(data = qq_data, x = ~Theoretical, y = ~Sample, type = 'scatter',\n  mode = 'markers', marker = list(size = 3, color = '#2E86C1', opacity = 0.6),\n  name = \"Returns\")\n\nfig_qq <- fig_qq %>%\n  add_lines(\n    x = ~Theoretical,\n    y = ~Theoretical * slope + int, \n    line = list(color = \"#E74C3C\", width = 2, dash = \"dash\"), \n    name = \"Normal Reference\",\n    inherit = FALSE\n    ) %>%\n    \n    layout(\n      title = \"Q-Q Plot: Normal vs Empirical\",\n      xaxis = list(title = \"Theoretical Quantiles (Normal)\"),\n      yaxis = list(title = \"Sample Quantiles (ASML)\")\n    )\n\nfig_qq\n```\n\n::: {.cell-output-display}\n![Q-Q Plot of ASML Log-Returns](01-EDA_files/figure-pdf/qq-plot-1.pdf){fig-pos='H' width=100%}\n:::\n:::\n\n\nThe **Q-Q plot** confirms the findings from the histogram. While the central observations (the body of the distribution) align well with the theoretical normal line (in red), the extreme values at both ends deviate significantly, forming an '*S-shape*'. This provides clear visual evidence of fat tails (leptokurtosis), reinforcing the stylized fact that extreme market movements occur more frequently than predicted by a Gaussian model.\n\n### Synthetic indicators\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndesc_stats <- data.frame(\n  Metric = c(\"Mean\", \"Std. Dev.\", \"Skewness\", \"Kurtosis\"),\n  Value = c(\n    mean(log_returns$LogReturns),\n    sd(log_returns$LogReturns),\n    skewness(log_returns$LogReturns),\n    kurtosis(log_returns$LogReturns)\n  )\n)\n\ndatatable(\n  desc_stats, \n  options = list(dom = 't', paging = FALSE), \n  rownames = FALSE\n  ) %>% formatRound('Value', digits = 5)\n```\n\n::: {.cell-output-display}\n![](01-EDA_files/figure-pdf/calc-stats-1.pdf){fig-pos='H' width=100%}\n:::\n:::\n\n\nAs we can see, the distribution has a mean close to zero, slight negative skewness, and significant leptokurtosis (fat tails). These characteristics align with the well-known **stylized facts** of financial log-returns, indicating a departure from normality.\n\n### Test of normality\n\nTo formally test the normality hypothesis, we employ the **Jarque-Bera test**, which is based on skewness and kurtosis matching a normal distribution.\n\n$$ H_0: \\text{The data is normally distributed (Skewness=0, Kurtosis=3)} $$ $$ H_1: \\text{The data is not normally distributed} $$\n\n\n::: {.cell}\n\n```{.r .cell-code}\njb_test <- jarque.bera.test(log_returns$LogReturns)\n\njb_res <- data.frame(\n  Test = \"Jarque-Bera\",\n  Statistic = round(jb_test$statistic, 2),\n  P_Value = ifelse(jb_test$p.value < 0.001, \"< 0.001\", round(jb_test$p.value, 4)),\n  Result = ifelse(jb_test$p.value < 0.05, \"Reject H0\", \"Fail to Reject H0\")\n)\ndatatable(jb_res, options = list(dom = 't'), rownames = FALSE)\n```\n\n::: {.cell-output-display}\n![](01-EDA_files/figure-pdf/normality-test-1.pdf){fig-pos='H' width=100%}\n:::\n:::\n\n\n\nSince the p-value is virtually zero (<0.001), we strongly reject the null hypothesis of normality. This confirms that ASML returns are not normally distributed.\n",
    "supporting": [
      "01-EDA_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{},\"value\":[]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}